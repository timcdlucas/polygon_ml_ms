\documentclass[review]{elsarticle}

\usepackage{geometry}
 \geometry{
 a4paper,
 left=30mm,
 right=30mm,
 top=10mm,
 bottom=20mm
 }

\usepackage{graphicx}
\usepackage{amsmath}

\renewcommand\thefigure{S\arabic{figure}} 
\renewcommand\thetable{S\arabic{table}} 

 \DeclareMathOperator*{\argmin}{\arg\!\min}
%% END MACROS SECTION

\usepackage{subcaption}

\usepackage{amssymb}
\usepackage{array}

\usepackage{lineno,hyperref}
\modulolinenumbers[5]

%\usepackage{numcompress}\bibliographystyle{model3-num-names}

\usepackage{natbib}
%\usepackage[numbers, sort&compress]{natbib}
%\setcitestyle{author[oxford]year}
\bibliographystyle{elsarticle-num}

%\geometry{verbose,tmargin=30mm,bmargin=25mm,lmargin=25mm,rmargin=25mm}
%\input{figures.tex}
%\pagestyle{empty}
\begin{document}
%\templatefigures{}




% Model ensembles with different response variables for base and meta models:



% Spatial and Spatio-temporal Epidemiology
% Special issue: Disease Surveillance and Infectious disease Modeling


\begin{frontmatter}

\title{Supporting information: Improving disaggregation models of malaria incidence by ensembling non-linear models of prevalence}

\end{frontmatter}

\clearpage
\tableofcontents

\section{Supplementary methods}

\subsection{Extended methods for machine learning models}

We trained five machine learning models to each prevalence dataset.
These models were elastic net, projection pursuit regression, random forest, boosted regression trees, neural networks.
All models were trained on untransformed prevalence data with any predictions below zero being set at zero.
For tree based models, transforming the data makes almost no difference.
For the other models, training on empirical logit transformed data was considered but as the final performance metric (correlation between predicted and observed polygon incidence data) was on an absolute scale it was deemed better to train the models on absolute scales.
For all models, the sample size of each survey was used as a weight.

Elastic net models are penalised, linear regression models.
They find the regression parameters that optimise
$$\hat{\beta} = \argmin_\beta \sum_{i=1}^N w_i(y_i - X_i\beta) ^ 2 + \lambda\left((1-\alpha)\beta^2 + \alpha|\beta|\right)$$
where $\beta$ is a vector of regression parameters, $y_i$ is the prevalence response data, $X_i$ is a vector of environmental covariates and $w_i$ is the weight given by the sample size. 
$\lambda$ is the penalty term and $\alpha$ controls the relative contribution of the l1 and l2 penalties.
With $\alpha = 0$ the model collapses to ridge regression while with $\alpha = 1$ the model is equivalent to the LASSO.
$\alpha$ and $\lambda$ are selected by a cross validation with candidate values given by a grid search.
We examined 15 values for $\alpha$ taken evenly between 0.05 and 1.
We examined 15 values for $\lambda$ taken as 14 values spread evenly on a log10 scale between -4 and -1 and additionally considering $\lambda = 0$ which gives the least squares estimate.



\clearpage
\section{Global dataset Machine Learning}

\clearpage
\subsection{Out-of-sample scatter plots}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnet_obspred_global.png}
\caption{
  Scatter plot of predictions and held out observed data for the neural network trained on the global dataset.
}

\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enet_obspred_global.png}
\caption{
  Scatter plot of predictions and held out observed data for the elastic net trained on the global dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppr_obspred_global.png}
\caption{
  Scatter plot of predictions and held out observed data for the PPR trained on the global dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ranger_obspred_global.png}
\caption{
  Scatter plot of predictions and held out observed data for the Random Forest trained on the global dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/gbm_obspred_global.png}
\caption{
  Scatter plot of predictions and held out observed data for the GBM trained on the global dataset.
}

\end{figure}


\clearpage
\subsection{Hyperparameter optimisation}

As ranger and GBM were tuned with random hyperparameter search, the plots become difficult and are not included.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnetopt_global.png}
\caption{
  Optimisation for neural network hyperparameters trained on the global dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enetopt_global.png}
\caption{
  Optimisation for elastic net hyperparameters trained on the global dataset.
}
\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppropt.png}
\caption{
  Optimisation for PPR hyperparameters trained on the global dataset.
}

\end{figure}




\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Colombia (South America) prevalence dataset Machine Learning}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Predictions}

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/SA_all_ml.png}
\caption{
  Predictions from machine learning models trained on South American prevalence data.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/COL_all_globalml.png}
\caption{
  Predictions over Colombia from machine learning models trained on global prevalence data.
}

\end{figure}




\clearpage
\subsection{Out-of-sample scatter plots}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnet_obspred_sa.png}
\caption{
  Scatter plot of predictions and held out observed data for the neural network trained on the South America dataset.
}

\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enet_obspred_sa.png}
\caption{
  Scatter plot of predictions and held out observed data for the elastic net trained on the South America dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppr_obspred_sa.png}
\caption{
  Scatter plot of predictions and held out observed data for the PPR trained on the South America dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ranger_obspred_sa.png}
\caption{
  Scatter plot of predictions and held out observed data for the Random Forest trained on the South America dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/gbm_obspred_sa.png}
\caption{
  Scatter plot of predictions and held out observed data for the GBM trained on the South America dataset.
}

\end{figure}


\clearpage
\subsection{Hyperparameter optimisation}

As ranger and GBM were tuned with random hyperparameter search, the plots become difficult and are not included.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnetopt_sa.png}
\caption{
  Optimisation for neural network hyperparameters trained on the South America dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enetopt_sa.png}
\caption{
  Optimisation for elastic net hyperparameters trained on the South America dataset.
}
\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppropt_sa.png}
\caption{
  Optimisation for PPR hyperparameters trained on the South America dataset.
}

\end{figure}












\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Indonesia dataset Machine Learning}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\subsection{Predictions}

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/idn_all_ml.png}
\caption{
  Predictions from machine learning models trained on Indonesian prevalence data.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/idn_all_globalml.png}
\caption{
  Predictions over Indonesia from machine learning models trained on global prevalence data.
}

\end{figure}




\clearpage
\subsection{Out-of-sample scatter plots}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnet_obspred_idn.png}
\caption{
  Scatter plot of predictions and held out observed data for the neural network trained on the Indonesia dataset.
}

\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enet_obspred_idn.png}
\caption{
  Scatter plot of predictions and held out observed data for the elastic net trained on the Indonesia dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppr_obspred_idn.png}
\caption{
  Scatter plot of predictions and held out observed data for the PPR trained on the Indonesia dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ranger_obspred_idn.png}
\caption{
  Scatter plot of predictions and held out observed data for the Random Forest trained on the Indonesia dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/xgboost_obspred_idn.png}
\caption{
  Scatter plot of predictions and held out observed data for the GBM trained on the Indonesia dataset.
}

\end{figure}


\clearpage
\subsection{Hyperparameter optimisation}

As ranger and GBM were tuned with random hyperparameter search, the plots become difficult and are not included.


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enetopt_idn.png}
\caption{
  Optimisation for elastic net hyperparameters trained on the Indonesia dataset.
}
\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppropt_idn.png}
\caption{
  Optimisation for PPR hyperparameters trained on the Indonesia dataset.
}

\end{figure}






\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Madagascar dataset Machine Learning}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





\subsection{Predictions}

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/MDG_all_ml.png}
\caption{
  Predictions from machine learning models trained on Malagasy prevalence data.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/MDG_all_globalml.png}
\caption{
  Predictions over Madagascar from machine learning models trained on global prevalence data.
}

\end{figure}




\clearpage
\subsection{Out-of-sample scatter plots}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnet_obspred_mdg.png}
\caption{
  Scatter plot of predictions and held out observed data for the neural network trained on the Madagascar dataset.
}

\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enet_obspred_mdg.png}
\caption{
  Scatter plot of predictions and held out observed data for the elastic net trained on the Madagascar dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppr_obspred_mdg.png}
\caption{
  Scatter plot of predictions and held out observed data for the PPR trained on the Madagascar dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ranger_obspred_mdg.png}
\caption{
  Scatter plot of predictions and held out observed data for the Random Forest trained on the Madagascar dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/xgboost_obspred_mdg.png}
\caption{
  Scatter plot of predictions and held out observed data for the GBM trained on the Madagascar dataset.
}

\end{figure}


\clearpage
\subsection{Hyperparameter optimisation}

As ranger and GBM were tuned with random hyperparameter search, the plots become difficult and are not included.


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enetopt_mdg.png}
\caption{
  Optimisation for elastic net hyperparameters trained on the Madagascar dataset.
}
\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppropt_mdg.png}
\caption{
  Optimisation for PPR hyperparameters trained on the Madagascar dataset.
}

\end{figure}








\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Senegal dataset Machine Learning}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






\subsection{Predictions}

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/sen_all_ml.png}
\caption{
  Predictions from machine learning models trained on Senegal prevalence data.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{figs/SI/sen_all_globalml.png}
\caption{
  Predictions from machine learning models trained on Senegal prevalence data.
}

\end{figure}



\clearpage
\subsection{Out-of-sample scatter plots}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/nnet_obspred_sen.png}
\caption{
  Scatter plot of predictions and held out observed data for the neural network trained on the Senegal dataset.
}

\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enet_obspred_sen.png}
\caption{
  Scatter plot of predictions and held out observed data for the elastic net trained on the Senegal dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppr_obspred_sen.png}
\caption{
  Scatter plot of predictions and held out observed data for the PPR trained on the Senegal dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ranger_obspred_sen.png}
\caption{
  Scatter plot of predictions and held out observed data for the Random Forest trained on the Senegal dataset.
}

\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/xgboost_obspred_sen.png}
\caption{
  Scatter plot of predictions and held out observed data for the GBM trained on the Senegal dataset.
}

\end{figure}


\clearpage
\subsection{Hyperparameter optimisation}

As ranger and GBM were tuned with random hyperparameter search, the plots become difficult and are not included.


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/enetopt_sen.png}
\caption{
  Optimisation for elastic net hyperparameters trained on the Senegal dataset.
}
\end{figure}



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{figs/SI/ppropt_sen.png}
\caption{
  Optimisation for PPR hyperparameters trained on the Senegal dataset.
}

\end{figure}



%\section*{Citations}
%\bibliography{Malaria} 
%\bibliographystyle{unsrt}
%\bibliographystyle{apalike}




\end{document}









